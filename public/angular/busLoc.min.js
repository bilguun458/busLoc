(function(){"use strict";angular.module("busLocApp",["ngRoute"]);t.$inject=["$routeProvider"];function t(t){t.when("/",{templateUrl:"home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/about",{templateUrl:"about/about.view.html",controller:"aboutCtrl",controllerAs:"vm"}).when("/why",{templateUrl:"common/views/genericText.view.html",controller:"whyCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"})}angular.module("busLocApp").config(["$routeProvider",t])})();(function(){"use strict";angular.module("busLocApp").controller("homeCtrl",t);t.$inject=["$scope","transdepData","$sce","$window"];function t(t,e,n,o){var r=this;var i=new google.maps.DirectionsService;var a=new google.maps.DirectionsRenderer;var u="/images/pin.png";var s="AIzaSyCjCauLhho2YsU-lRT4XZC91PIBwqhO-48";e.getRoutes().then(function(t){r.routes=t.data;r.parseData()}).catch(function(t){console.log(t)});r.parseData=function(){r.departures=[];for(var t=0;t<r.routes.length;t++)for(var e=0;e<r.routes[t].departures.length;e++){r.departures.push({origin:r.routes[t].origin.name,destination:r.routes[t].destination.name,date:r.routes[t].departures[e].date,bus:r.routes[t].departures[e].bus,routeIdx:t})}r.search(0)};r.search=function(n){r.route=r.routes[r.departures[n].routeIdx];r.route.date=r.departures[n].date;t.searchMessage="Чиглэл: "+r.route.origin.name+"-"+r.route.destination.name;e.getBusLocation(r.departures[n].bus.licenseNumber).then(function(t){r.busLoc=t.data;r.getRemainingTime();r.calculateAndDisplayRoute()}).catch(function(t){r.searchMessage="Хайлт олдсонгүй";console.log(err)})};r.getRemainingTime=function(){var e={origin:r.busLoc.lat+", "+r.busLoc.lng,destination:r.route.destination.lat+", "+r.route.destination.lng,travelMode:"DRIVING"};i.route(e,function(e,n){if(n==="OK"){t.searchMessage+="\n"+r.route.destination.name+" хүртэл "+e.routes[0].legs[0].distance.text+" зам үлдсэн ба ойролцоогоор "+e.routes[0].legs[0].duration.text+" дараа очно."}else{window.alert("Directions request failed due to "+n)}});var e={origin:r.route.origin.lat+", "+r.route.origin.lng,destination:r.busLoc.lat+", "+r.busLoc.lng,travelMode:"DRIVING"};i.route(e,function(e,n){if(n==="OK"){t.searchMessage+="\n"+r.route.origin.name+"-с хөдлөөд "+e.routes[0].legs[0].distance.text+" замыг "+e.routes[0].legs[0].duration.text+" хугацаанд туулсан."}else{window.alert("Directions request failed due to "+n)}})};r.calculateAndDisplayRoute=function(){r.busMarker=new google.maps.Marker({position:r.busLoc,map:r.map,title:"Автобус",animation:google.maps.Animation.DROP,label:"Bus"});var t={origin:r.route.origin.lat+", "+r.route.origin.lng,destination:r.route.destination.lat+", "+r.route.destination.lng,travelMode:"DRIVING",waypoints:[]};r.route.waypoints.forEach(function(e){t.waypoints.push({location:e.lat+", "+e.lng,stopover:true})});i.route(t,function(t,e){if(e==="OK"){a.setDirections(t)}else{window.alert("Directions request failed due to "+e)}})};o.initMap=function(){r.map=new google.maps.Map(document.getElementById("map"),{zoom:7,center:{lat:47.918958,lng:106.917622}});a.setMap(r.map)};o.initMap()}})();(function(){angular.module("busLocApp").controller("aboutCtrl",t);t.$inject=["$sce"];function t(t){var e=this}})();(function(){angular.module("busLocApp").controller("whyCtrl",t);t.$inject=["$sce"];function t(t){var e=this;e.main={title:"Энэ web application-ийг яагаад үүсгэх болсон бэ?",content:"Хот хоорондын зорчигч тээврээр үйлчлүүлж байгаа хүмүүсийг очих газар нь хүлээн авах хүмүүс нь байн байн залгаж хаана явааг нь асуудаг. Энэ үйл ажиллагааг хөнгөлөх зорилгоор хүлээн авах хүн тухайн зорчигчийн зорчиж буй чиглэл, хөдлөсөн цаг огноо, зорчиж буй тээврийн хэрэгслийн жолооч ба улсын дугаар гэсэн мэдээлэл дээр тулгуурлан тухайн зорчиж буй тээврийн хэрэгслийн байршил болон зорьсон газраа очих хугацааг ойролцоогоор мэдэх боломжийг олгоно."};e.main.title=t.trustAsHtml(e.main.title);e.main.content=t.trustAsHtml(e.main.content)}})();(function(){"use strict";angular.module("busLocApp").controller("routeCtrl",t);t.$inject=["$scope","transdepData"];function t(t,e){var n=this;e.getStations().then(function(t){n.stations=t.data}).catch(function(t){console.log(t)});e.getRoutes().then(function(t){n.routes=t.data}).catch(function(t){console.log(t)})}})();(function(){angular.module("busLocApp").directive("navigation",t);function t(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html"}}})();(function(){"use strict";angular.module("busLocApp").service("transdepData",t);t.$inject=["$http"];function t(t){var e=this;e.getStations=function(){return t.get("api/route/stations")};e.getRoutes=function(){return t.get("api/route/routes")};e.getPointsByLNumber=function(e){return t.get("api/route/routes/points/"+e)};e.getBusLocation=function(e){return t.get("api/route/bus/"+e)}}})();(function(){"use strict";angular.module("busLocApp").service("googleDirection",t);t.$inject=["$http"];function t(t){var e=this;e.remainingTime=function(e,n,o){return t.get("https://maps.googleapis.com/maps/api/distancematrix/json",{params:{units:"metre",origins:e,destinations:n,key:o}})}}})();(function(){"use strict";angular.module("busLocApp").filter("dateInMillis",t);function t(){return function(t){return Date.parse(t)}}})();(function(){angular.module("busLocApp").filter("addHtmlLineBreaks",t);function t(){return function(t){var e=String(t).replace(/\n/g,"<br/>");return e}}})();