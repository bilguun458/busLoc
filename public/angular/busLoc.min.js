(function(){"use strict";angular.module("busLocApp",["ngRoute"]);t.$inject=["$routeProvider"];function t(t){t.when("/",{templateUrl:"home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/route",{templateUrl:"route/route.view.html",controller:"routeCtrl",controllerAs:"vm"}).when("/about",{templateUrl:"about/about.view.html",controller:"aboutCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"})}angular.module("busLocApp").config(["$routeProvider",t])})();(function(){"use strict";angular.module("busLocApp").controller("homeCtrl",t);t.$inject=["$scope","transdepData","$sce","$window"];function t(t,e,o,n){var r=this;e.getRoutes().then(function(t){r.routes=t.data;r.parseData()}).catch(function(t){console.log(t)});r.parseData=function(){r.departures=[];for(var t=0;t<r.routes.length;t++)for(var e=0;e<r.routes[t].departures.length;e++){r.departures.push({origin:r.routes[t].from,destination:r.routes[t].to,date:r.routes[t].departures[e].date,bus:r.routes[t].departures[e].bus})}console.log(r.routes);console.log(r.departures)};var a=new google.maps.DirectionsService;var i=new google.maps.DirectionsRenderer;var s="/images/bus.png";r.search=function(t){r.pointStr="";e.getBusLocation(t).then(function(t){r.busLoc=t.data}).catch(function(t){r.searchMessage="Хайлт олдсонгүй";console.log(err)});e.getPointsByLNumber(t).then(function(t){r.waypoints=t.data.points;if(r.waypoints===undefined){r.searchMessage="Хайлт олдсонгүй"}else{r.searchMessage="Чиглэл: "+t.data.from+"-"+t.data.to;r.calculateAndDisplayRoute()}}).catch(function(t){r.searchMessage="Хайлт олдсонгүй";console.log(t)})};r.calculateAndDisplayRoute=function(){r.busMarker=new google.maps.Marker({position:{lat:47.34789552369882,lng:104.29183959960939},map:r.map,title:"Автобус",icon:s});var t={origin:r.waypoints[0].lat.toString()+", "+r.waypoints[0].lon.toString(),destination:r.waypoints[r.waypoints.length-1].lat.toString()+", "+r.waypoints[r.waypoints.length-1].lon.toString(),travelMode:"DRIVING",waypoints:[]};for(var e=1;e<r.waypoints.length;e++){t.waypoints.push({location:r.waypoints[e].lat.toString()+", "+r.waypoints[e].lon.toString(),stopover:true})}a.route(t,function(t,e){if(e==="OK"){i.setDirections(t)}else{window.alert("Directions request failed due to "+e)}})};n.initMap=function(){r.map=new google.maps.Map(document.getElementById("map"),{zoom:7,center:{lat:47.918958,lng:106.917622}});i.setMap(r.map)};n.initMap()}})();(function(){angular.module("busLocApp").controller("aboutCtrl",t);t.$inject=["$sce"];function t(t){var e=this;e.main={title:"Автотээврийн үндэсний төвийн системээс авах өгөгдлийн талаар"};e.main.title=t.trustAsHtml(e.main.title);e.main.content=t.trustAsHtml(e.main.content.replace(/\n/g,"<br/>"))}})();(function(){"use strict";angular.module("busLocApp").controller("routeCtrl",t);t.$inject=["$scope","transdepData"];function t(t,e){var o=this;e.getStations().then(function(t){o.stations=t.data}).catch(function(t){console.log(t)});e.getRoutes().then(function(t){o.routes=t.data}).catch(function(t){console.log(t)})}})();(function(){angular.module("busLocApp").directive("navigation",t);function t(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html"}}})();(function(){"use strict";angular.module("busLocApp").service("transdepData",t);t.$inject=["$http"];function t(t){var e=this;e.getStations=function(){return t.get("api/route/stations")};e.getRoutes=function(){return t.get("api/route/routes")};e.getPointsByLNumber=function(e){return t.get("api/route/routes/points/"+e)};e.getBusLocation=function(e){return t.get("api/route/bus/"+e)}}})();(function(){"use strict";angular.module("busLocApp").filter("dateInMillis",t);function t(){return function(t){return Date.parse(t)}}})();(function(){angular.module("busLocApp").filter("addHtmlLineBreaks",t);function t(){return function(t){var e=String(t).replace(/\n/g,"<br/>");return e}}})();